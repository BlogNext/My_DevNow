---
import Container from '@components/Container.astro';
import TableOfContents from '@components/TableOfContents.astro';
import Code from '@components/mdx/Code.astro';
import SButton from '@components/mdx/MDButton.astro';
import BlogPost from '@layouts/BlogPost.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
type Props = { doc: CollectionEntry<'doc'> };

// 在 server 模式中选择加入预渲染
export const prerender = true;

export async function getStaticPaths() {
  const docs = await getCollection('doc');

  return docs.map((post) => ({
    params: { slug: post.slug },
    props: { doc: post }
  }));
}

const { doc: post } = Astro.props;
const { Content, remarkPluginFrontmatter, headings } = await post.render();
---

<BlogPost
  id={post.id as any}
  data={post.data}
  headings={headings}
  readTime={remarkPluginFrontmatter.minutesRead}
>
  <div class='grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8'>
    <!-- aside -->
    <aside class='md:flex flex-col gap-8 hidden'>
      <div class='sticky top-24 self-start hidden md:block transition-all duration-200'>
        {headings && headings.length > 0 && <TableOfContents {headings} />}
      </div>
    </aside>

    <Container>
      <article class='max-w-screen-md mx-auto'>
        <div class='mx-auto my-3 prose prose-base dark:prose-invert prose-a:text-blue-600'>
          <div class='prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full'>
            <Content components={{ pre: Code, SButton }} />
          </div>
        </div>
      </article>
    </Container>
  </div>
</BlogPost>
